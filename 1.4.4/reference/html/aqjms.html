<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>AQ/JMS</title>
<link rel="stylesheet" href="css/site.css">
<script src="js/setup.js"></script><script defer src="js/site.js"></script>

</head>
<body class="article toc2 toc-left"><div id="banner-container" class="container" role="banner">
  <div id="banner" class="contained" role="banner">
    <div id="switch-theme">
      <input type="checkbox" id="switch-theme-checkbox" />
      <label for="switch-theme-checkbox">Dark Theme</label>
    </div>
  </div>
</div>
<div id="tocbar-container" class="container" role="navigation">
  <div id="tocbar" class="contained" role="navigation">
    <button id="toggle-toc"></button>
  </div>
</div>
<div id="main-container" class="container">
  <div id="main" class="contained">
    <div id="doc" class="doc">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<span id="back-to-index"><a href="index.html">Back to index</a></span><ul class="sectlevel1">
<li><a href="#aqjms">AQ/JMS</a>
<ul class="sectlevel2">
<li><a href="#using-aqjms">Using AQ/JMS</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="aqjms"><a class="anchor" href="#aqjms"></a>AQ/JMS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This starter provides support for Oracle Transactional Event Queues (TxEventQ) and Oracle Advanced Queuing (AQ) as Java Message Service (JMS) providers. It depends on the Universal Connection Pool (UCP) starter.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong>: By default, the data Source and JMS Connection Factory that the starter injects into your application share the same database transaction.  This means that you can start a transaction, read from a queue, perform an update operation, and then commit or rollback that whole unit of work, including the message consumption.</p>
</div>
<div class="paragraph">
<p>To add this starter to your project, add this Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.oracle.database.spring<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>oracle-spring-boot-starter-aqjms<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>25.3.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For Gradle projects, add this dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dependencies {
    implementation 'com.oracle.database.spring:oracle-spring-boot-starter-aqjms:25.1.0'
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="using-aqjms"><a class="anchor" href="#using-aqjms"></a>Using AQ/JMS</h3>
<div class="paragraph">
<p>To configure your application to use Oracle Transactional Event Queues or Oracle Advanced Queuing, you must annotate you application with the <code>@EnableJms</code> annotation, and create the
two following beans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>JmsListenerContainerFactory&lt;?&gt;</code> bean, which can be created as shown in the following example. Note that you can override settings if you need to.  Also, note that the name of the method defines the name of the factory, which you will use when creating JMS listeners.</p>
</li>
<li>
<p>A <code>MessageConverter</code> bean to map objects of your class representing the payload into a text based format (like JSON) that can be used in the actual messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note</strong>: Any queues or topics that you want to use must be pre-created in the database. See [Sample Code](<a href="https://www.oracle.com/database/advanced-queuing/#rc30sample-code" class="bare">https://www.oracle.com/database/advanced-queuing/#rc30sample-code</a>) for
examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.aqjms</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">jakarta.jms.ConnectionFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.jms.DefaultJmsListenerContainerFactoryConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ConfigurableApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jms.annotation.EnableJms</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jms.config.DefaultJmsListenerContainerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jms.config.JmsListenerContainerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jms.core.JmsTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jms.support.converter.MappingJackson2MessageConverter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jms.support.converter.MessageConverter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jms.support.converter.MessageType</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableJms</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JmsSampleApplication</span> <span class="o">{</span>

 <span class="nd">@Bean</span>
 <span class="kd">public</span> <span class="nc">JmsListenerContainerFactory</span><span class="o">&lt;?&gt;</span> <span class="n">myFactory</span><span class="o">(</span><span class="nc">ConnectionFactory</span> <span class="n">connectionFactory</span><span class="o">,</span>
       <span class="nc">DefaultJmsListenerContainerFactoryConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
   <span class="nc">DefaultJmsListenerContainerFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultJmsListenerContainerFactory</span><span class="o">();</span>
   <span class="c1">// This provides all Boot's defaults to this factory, including the message converter</span>
   <span class="n">configurer</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">connectionFactory</span><span class="o">);</span>
   <span class="c1">// You could override some of Boot's defaults here if necessary</span>
   <span class="k">return</span> <span class="n">factory</span><span class="o">;</span>
 <span class="o">}</span>

 <span class="nd">@Bean</span>
 <span class="kd">public</span> <span class="nc">MessageConverter</span> <span class="nf">jacksonJmsMessageConverter</span><span class="o">()</span> <span class="o">{</span>
   <span class="nc">MappingJackson2MessageConverter</span> <span class="n">converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MappingJackson2MessageConverter</span><span class="o">();</span>
   <span class="n">converter</span><span class="o">.</span><span class="na">setTargetType</span><span class="o">(</span><span class="nc">MessageType</span><span class="o">.</span><span class="na">TEXT</span><span class="o">);</span>
   <span class="n">converter</span><span class="o">.</span><span class="na">setTypeIdPropertyName</span><span class="o">(</span><span class="s">"_type"</span><span class="o">);</span>
   <span class="k">return</span> <span class="n">converter</span><span class="o">;</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
   <span class="nc">ConfigurableApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">JmsSampleApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
 <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To send a message to a JMS queue or topic, get an instance of the <code>JmsTemplate</code> from the Spring Application context, and call the <code>convertAndSend()</code> method specifying the name of the queue or
topic, and providing the object to be converted and sent in the payload of the message, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="nc">JmsTemplate</span> <span class="n">jmsTemplate</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">JmsTemplate</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">jmsTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">"mailbox"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Email</span><span class="o">(-</span><span class="mi">1</span><span class="o">,</span> <span class="s">"info@example.com"</span><span class="o">,</span> <span class="s">"Hello"</span><span class="o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To receive messages from a JMS queue or topic, create a method that takes your message class, for example <code>Email</code>, as input. Annotate the method with the <code>@JmsListener</code> annotation, specifying the destination, that is the name of the queue or topic, and the container factory name that you created earlier, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.example.aqjms</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.jms.annotation.JmsListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Receiver</span> <span class="o">{</span>

    <span class="nd">@JmsListener</span><span class="o">(</span><span class="n">destination</span> <span class="o">=</span> <span class="s">"mailbox"</span><span class="o">,</span> <span class="n">containerFactory</span> <span class="o">=</span> <span class="s">"myFactory"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">receiveMessage</span><span class="o">(</span><span class="nc">Email</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Received &lt;"</span> <span class="o">+</span> <span class="n">email</span> <span class="o">+</span> <span class="s">"&gt;"</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: The starter uses the configuration for <code>spring.datasource</code> as the connection details for the Oracle Database hosting the queues and topics. If you wish to use a different configuration, you must use a named configuration, for example <code>spring.datasource.txeventq</code> and use Java configuration and annotate the configuration with the standard Spring <code>@Qualifier</code> annotation, specifying the correct name, for example <code>txevevntq</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-06-27 12:54:36 -0500
</div>
</div>
</div>
  </div>
</div>
</body>
</html>